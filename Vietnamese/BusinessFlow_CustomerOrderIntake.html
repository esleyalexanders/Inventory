<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quy Trình: Tiếp Nhận Đơn Hàng Khách - Tự Động ERP</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            body {
                font-family: Arial, Helvetica, sans-serif;
                line-height: 1.6;
                color: #000;
                background: #fff;
            }
            .container {
                max-width: 1200px;
                margin: 0 auto;
                padding: 40px 20px;
            }
            .header {
                border-bottom: 3px solid #000;
                padding-bottom: 20px;
                margin-bottom: 40px;
            }
            .header h1 {
                font-size: 28px;
                font-weight: bold;
                margin-bottom: 10px;
                color: #1a1a1a;
            }
            .header p {
                font-size: 16px;
                color: #666;
            }
            .back-link {
                display: inline-block;
                margin-bottom: 20px;
                color: #2c5aa0;
                text-decoration: none;
                font-size: 14px;
            }
            .back-link:hover {
                text-decoration: underline;
            }
            .section {
                margin-bottom: 40px;
            }
            h2 {
                font-size: 22px;
                font-weight: bold;
                margin-bottom: 20px;
                padding-bottom: 10px;
                border-bottom: 2px solid #333;
                color: #1a1a1a;
            }
            h3 {
                font-size: 18px;
                font-weight: bold;
                margin: 25px 0 15px 0;
                padding: 12px;
                background: #f5f5f5;
                border-left: 4px solid #666;
            }
            h4 {
                font-size: 16px;
                font-weight: bold;
                margin: 20px 0 10px 0;
                color: #333;
            }
            p {
                margin-bottom: 12px;
                font-size: 14px;
            }
            ul {
                margin: 10px 0 15px 25px;
                font-size: 14px;
            }
            li {
                margin: 8px 0;
            }
            .flowchart-container {
                background: #f8f8f8;
                border: 2px solid #ddd;
                border-radius: 5px;
                padding: 30px;
                margin: 30px 0;
                text-align: center;
                overflow-x: auto;
            }
            .mermaid {
                display: inline-block;
                text-align: left;
            }
            .explanation-box {
                border: 2px solid #666;
                padding: 25px;
                margin: 20px 0;
                background: #f8f8f8;
                border-radius: 5px;
            }
            .step-box {
                background: #fff;
                border: 1px solid #ddd;
                padding: 15px;
                margin: 10px 0;
                border-left: 4px solid #2c5aa0;
            }
            .step-box h4 {
                color: #2c5aa0;
                margin-top: 0;
            }
            .automation-point {
                border-left: 4px solid #28a745;
                padding: 15px 20px;
                margin: 15px 0;
                background: #f1f9f4;
            }
            .automation-point h4 {
                color: #28a745;
                margin-top: 0;
            }
            .code-section {
                margin: 30px 0;
            }
            .code-container {
                background: #2d2d2d;
                border-radius: 5px;
                padding: 0;
                margin: 20px 0;
                position: relative;
            }
            .code-header {
                background: #1a1a1a;
                padding: 10px 20px;
                border-radius: 5px 5px 0 0;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            .code-title {
                color: #fff;
                font-size: 14px;
                font-weight: bold;
            }
            .copy-button {
                background: #2c5aa0;
                color: #fff;
                border: none;
                padding: 6px 15px;
                border-radius: 3px;
                cursor: pointer;
                font-size: 12px;
                transition: background 0.3s;
            }
            .copy-button:hover {
                background: #1e3f7a;
            }
            .copy-button.copied {
                background: #28a745;
            }
            pre {
                margin: 0;
                padding: 20px;
                overflow-x: auto;
            }
            code {
                font-family: 'Courier New', monospace;
                font-size: 13px;
                color: #f8f8f2;
                line-height: 1.5;
            }
            .legend {
                background: #fff;
                border: 1px solid #ddd;
                padding: 20px;
                margin: 20px 0;
                border-radius: 5px;
            }
            .legend h4 {
                margin-top: 0;
                margin-bottom: 15px;
            }
            .legend-item {
                display: inline-block;
                margin-right: 30px;
                margin-bottom: 10px;
            }
            .legend-color {
                display: inline-block;
                width: 30px;
                height: 20px;
                border-radius: 3px;
                margin-right: 8px;
                vertical-align: middle;
            }
            .color-manual {
                background: #fff3e0;
                border: 2px solid #ef6c00;
            }
            .color-decision {
                background: #ffebee;
                border: 2px solid #c62828;
            }
            .color-system {
                background: #e3f2fd;
                border: 2px solid #1976d2;
            }
            @media print {
                .container {
                    max-width: 100%;
                }
                .copy-button {
                    display: none;
                }
            }
        </style>
</head>
<body>
    <div class="container">
        <!-- Back Link -->
        <a href="index.html" class="back-link">← Quay lại Tổng Quan Hệ Thống</a>
        <!-- Header -->
        <div class="header">
            <h1>Quy Trình: Tiếp Nhận Đơn Hàng Khách</h1>
            <p>Quy trình tự động tiếp nhận, kiểm tra và xử lý đơn hàng khách</p>
        </div>
        <!-- Section 1: Visual Flowchart -->
        <div class="section">
            <h2>1. Sơ Đồ Quy Trình</h2>
            <div class="flowchart-container">
                <div class="mermaid">
flowchart TD
    A[Khách gửi đơn hàng qua cổng/API/email] --> B[Hệ thống nhận đơn hàng]
    B --> C{Dữ liệu đơn hàng hợp lệ?}
    C -->|Không| D[Hệ thống báo lỗi cho người dùng]
    D --> E[Người dùng sửa đơn và gửi lại]
    E --> B
    C -->|Có| F[Hệ thống kiểm tra trạng thái khách hàng]
    F --> G{Khách hoạt động & tín dụng OK?}
    G -->|Không| H[Hệ thống chuyển cho bộ phận kinh doanh/tài chính kiểm tra]
    H --> I[Kinh doanh/Tài chính duyệt hoặc từ chối]
    I -->|Từ chối| J[Hệ thống báo khách: Đơn bị từ chối]
    I -->|Duyệt| K[Tiếp tục tiếp nhận đơn hàng]
    G -->|Có| K
    K --> L[Hệ thống tạo phiếu đơn hàng]
    L --> M[Hệ thống kích hoạt lập kế hoạch tự động]
    M --> N[Trạng thái đơn: Đã tiếp nhận]
    N --> O[Thông báo cho các bộ phận liên quan: kinh doanh, kế hoạch, kho]

    classDef system fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef decision fill:#ffebee,stroke:#c62828,stroke-width:2px
    classDef manual fill:#fff3e0,stroke:#ef6c00,stroke-width:2px
    
    class A,B,D,E,F,H,I,J,L,M,N,O manual
    class C,G decision
                </div>
            </div>
            <!-- Legend -->
            <div class="legend">
                <h4>Chú Giải Quy Trình:</h4>
                <div class="legend-item">
                    <span class="legend-color color-manual"></span>
                    <span>Bước thao tác/Xử lý</span>
                </div>
                <div class="legend-item">
                    <span class="legend-color color-decision"></span>
                    <span>Điểm quyết định</span>
                </div>
                <div class="legend-item">
                    <span class="legend-color color-system"></span>
                    <span>Hệ thống/Tự động</span>
                </div>
            </div>
        </div>
        <!-- Section 2: Flow Explanation -->
        <div class="section">
            <h2>2. Giải Thích Quy Trình</h2>
            <div class="explanation-box">
                <p>Quy trình tự động này quản lý toàn bộ việc tiếp nhận đơn hàng khách từ lúc gửi PO đến khi tạo phiếu đơn và kích hoạt lập kế hoạch. Hệ thống tự động kiểm tra dữ liệu, xác minh khách hàng, xử lý ngoại lệ và chuyển tiếp tự động cho các quy trình tiếp theo.</p>
            </div>
            <h3>Các Bước Quy Trình</h3>
            <div class="step-box">
                <h4>Bước 1: Gửi Đơn Hàng</h4>
                <p><strong>Thao tác:</strong> Khách gửi đơn hàng (PO) qua cổng, API hoặc email.</p>
                <p><strong>Hệ thống:</strong> Hỗ trợ nhiều kênh tiếp nhận linh hoạt.</p>
            </div>
            <div class="step-box">
                <h4>Bước 2: Nhận Đơn Hàng</h4>
                <p><strong>Thao tác:</strong> Hệ thống nhận và lưu dữ liệu đơn hàng.</p>
                <p><strong>Hệ thống:</strong> Dữ liệu PO được phân tích và lưu tạm thời.</p>
            </div>
            <div class="step-box">
                <h4>Bước 3: Kiểm Tra Dữ Liệu Đơn</h4>
                <p><strong>Quyết định:</strong> Dữ liệu đơn hàng hợp lệ?</p>
                <p><strong>Kiểm tra hợp lệ:</strong></p>
                <ul>
                    <li>Đủ trường thông tin (khách, mã BOM, số lượng, ngày giao)</li>
                    <li>Đúng định dạng dữ liệu</li>
                    <li>Kiểm tra trùng lặp đơn hàng</li>
                    <li>Mã BOM tồn tại trong dữ liệu gốc</li>
                    <li>Số lượng nằm trong giới hạn cho phép</li>
                </ul>
                <p><strong>Nếu không hợp lệ:</strong> Hệ thống báo lỗi chi tiết → Người dùng sửa và gửi lại → Quay lại bước 2</p>
                <p><strong>Nếu hợp lệ:</strong> Chuyển sang kiểm tra trạng thái khách hàng</p>
            </div>
            <div class="step-box">
                <h4>Bước 4: Kiểm Tra Trạng Thái Khách Hàng</h4>
                <p><strong>Thao tác:</strong> Hệ thống tự động kiểm tra trạng thái tài khoản khách hàng.</p>
                <p><strong>Hệ thống:</strong> Truy vấn dữ liệu gốc khách hàng về trạng thái hoạt động và tín dụng.</p>
            </div>
            <div class="step-box">
                <h4>Bước 5: Kiểm Tra Tín Dụng Khách</h4>
                <p><strong>Quyết định:</strong> Khách hoạt động và tín dụng OK?</p>
                <p><strong>Kiểm tra:</strong></p>
                <ul>
                    <li>Tài khoản khách đang hoạt động (không bị khóa/tạm ngưng)</li>
                    <li>Tình trạng tín dụng được duyệt (không bị giữ tín dụng)</li>
                    <li>Số dư trong hạn mức tín dụng</li>
                    <li>Không có hóa đơn quá hạn bị chặn</li>
                </ul>
                <p><strong>Nếu không OK:</strong> Hệ thống chuyển đơn sang bộ phận kinh doanh/tài chính kiểm tra → Quy trình duyệt ngoại lệ</p>
                <p><strong>Nếu OK:</strong> Tiếp tục tiếp nhận đơn hàng</p>
            </div>
            <div class="step-box">
                <h4>Bước 6: Duyệt Ngoại Lệ (Thủ Công)</h4>
                <p><strong>Thao tác:</strong> Bộ phận kinh doanh/tài chính kiểm tra đơn bị chặn.</p>
                <p><strong>Lựa chọn:</strong></p>
                <ul>
                    <li><strong>Từ chối:</strong> Hệ thống báo khách đơn bị từ chối, kết thúc quy trình</li>
                    <li><strong>Duyệt:</strong> Bỏ chặn tín dụng hoặc duyệt đặc biệt → Tiếp tục tiếp nhận đơn</li>
                </ul>
            </div>
            <div class="step-box">
                <h4>Bước 7: Tạo Phiếu Đơn Hàng</h4>
                <p><strong>Thao tác:</strong> Hệ thống tạo phiếu đơn hàng chính thức trong cơ sở dữ liệu.</p>
                <p><strong>Hệ thống:</strong></p>
                <ul>
                    <li>Tạo số đơn hàng duy nhất</li>
                    <li>Lưu thông tin đơn hàng và chi tiết dòng</li>
                    <li>Trạng thái ban đầu là "Mới"</li>
                    <li>Liên kết với dữ liệu khách hàng và BOM</li>
                </ul>
            </div>
            <div class="step-box">
                <h4>Bước 8: Kích Hoạt Lập Kế Hoạch Tự Động</h4>
                <p><strong>Thao tác:</strong> Hệ thống tự động kích hoạt quy trình lập kế hoạch.</p>
                <p><strong>Hệ thống:</strong> Gửi đơn hàng sang phân hệ lập kế hoạch để kiểm tra kho và lập lịch sản xuất (quy trình tiếp theo).</p>
            </div>
            <div class="step-box">
                <h4>Bước 9: Cập Nhật Trạng Thái</h4>
                <p><strong>Thao tác:</strong> Trạng thái đơn hàng cập nhật thành "Đã tiếp nhận".</p>
                <p><strong>Hệ thống:</strong> Đơn hàng hiển thị trên tất cả bảng điều khiển và báo cáo liên quan.</p>
            </div>
            <div class="step-box">
                <h4>Bước 10: Thông Báo Các Bộ Phận</h4>
                <p><strong>Thao tác:</strong> Hệ thống tự động thông báo cho các bộ phận liên quan.</p>
                <p><strong>Thông báo gửi đến:</strong></p>
                <ul>
                    <li>Bộ phận kinh doanh: Xác nhận đơn hàng</li>
                    <li>Bộ phận kế hoạch: Có đơn mới cần lập kế hoạch</li>
                    <li>Bộ phận kho: Báo trước nhu cầu vật tư</li>
                    <li>Khách hàng (tùy chọn): Email xác nhận đơn và số đơn hàng</li>
                </ul>
            </div>
            <h3>Các Điểm Tự Động Hóa Chính</h3>
            <div class="automation-point">
                <h4>✓ Kiểm Tra Đơn Hàng Tự Động</h4>
                <p>Tất cả kiểm tra hợp lệ được hệ thống thực hiện tự động - không cần nhập liệu hay kiểm tra thủ công. Lỗi được phát hiện ngay với thông báo chi tiết.</p>
            </div>
            <div class="automation-point">
                <h4>✓ Xác Minh Khách Hàng Tự Động</h4>
                <p>Kiểm tra trạng thái và tín dụng khách hàng thời gian thực từ dữ liệu gốc. Không cần tra cứu thủ công hay gọi bộ phận tài chính.</p>
            </div>
            <div class="automation-point">
                <h4>✓ Quản Lý Ngoại Lệ</h4>
                <p>Chỉ đơn hàng lỗi hoặc bị chặn tín dụng mới cần xử lý thủ công. Đơn hợp lệ từ khách đã duyệt sẽ tự động tiếp nhận.</p>
            </div>
            <div class="automation-point">
                <h4>✓ Tạo Phiếu Đơn Hàng Tự Động</h4>
                <p>Phiếu đơn hàng được tạo tự động với số thứ tự, liên kết dữ liệu và trạng thái ban đầu - không cần nhập phiếu thủ công.</p>
            </div>
            <div class="automation-point">
                <h4>✓ Chuyển Tiếp Lập Kế Hoạch Tự Động</h4>
                <p>Hệ thống tự động kích hoạt quy trình tiếp theo (lập kế hoạch và phân tích) mà không cần phối hợp hay giao việc thủ công.</p>
            </div>
            <div class="automation-point">
                <h4>✓ Thông Báo Tự Động</h4>
                <p>Tất cả thông báo cho các bộ phận được gửi tự động qua email/cảnh báo hệ thống - không cần thông báo thủ công khi có đơn mới.</p>
            </div>
        </div>
        <!-- Section 3: Mermaid Code -->
        <div class="section code-section">
            <h2>3. Mã Mermaid Quy Trình</h2>
            <p>Sao chép đoạn mã dưới đây để sử dụng sơ đồ này trong tài liệu hoặc công cụ hỗ trợ Mermaid.</p>
            <div class="code-container">
                <div class="code-header">
                    <span class="code-title">Mã Sơ Đồ Mermaid</span>
                    <button class="copy-button" onclick="copyCode()">Sao chép mã</button>
                </div>
                <pre><code id="mermaid-code">flowchart TD
    A[Khách gửi đơn hàng qua cổng/API/email] --> B[Hệ thống nhận đơn hàng]
    B --> C{Dữ liệu đơn hàng hợp lệ?}
    C -->|Không| D[Hệ thống báo lỗi cho người dùng]
    D --> E[Người dùng sửa đơn và gửi lại]
    E --> B
    C -->|Có| F[Hệ thống kiểm tra trạng thái khách hàng]
    F --> G{Khách hoạt động & tín dụng OK?}
    G -->|Không| H[Hệ thống chuyển cho bộ phận kinh doanh/tài chính kiểm tra]
    H --> I[Kinh doanh/Tài chính duyệt hoặc từ chối]
    I -->|Từ chối| J[Hệ thống báo khách: Đơn bị từ chối]
    I -->|Duyệt| K[Tiếp tục tiếp nhận đơn hàng]
    G -->|Có| K
    K --> L[Hệ thống tạo phiếu đơn hàng]
    L --> M[Hệ thống kích hoạt lập kế hoạch tự động]
    M --> N[Trạng thái đơn: Đã tiếp nhận]
    N --> O[Thông báo cho các bộ phận liên quan: kinh doanh, kế hoạch, kho]

    classDef system fill:#e3f2fd,stroke:#1976d2,stroke-width:2px
    classDef decision fill:#ffebee,stroke:#c62828,stroke-width:2px
    classDef manual fill:#fff3e0,stroke:#ef6c00,stroke-width:2px
    
    class A,B,D,E,F,H,I,J,L,M,N,O manual
    class C,G decision</code></pre>
            </div>
        </div>
        <!-- Footer -->
        <div style="margin-top: 60px; padding-top: 20px; border-top: 2px solid #333; text-align: center; color: #666; font-size: 12px;">
            <p>Hệ Thống Tự Động ERP - Tài Liệu Quy Trình</p>
            <p>Khởi tạo: Tháng 10 năm 2025</p>
        </div>
    </div>
    <script>
        // Initialize Mermaid
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });
        // Copy code function
        function copyCode() {
            const code = document.getElementById('mermaid-code').textContent;
            const button = document.querySelector('.copy-button');
            navigator.clipboard.writeText(code).then(function() {
                button.textContent = 'Đã sao chép!';
                button.classList.add('copied');
                setTimeout(function() {
                    button.textContent = 'Sao chép mã';
                    button.classList.remove('copied');
                }, 2000);
            }).catch(function(err) {
                console.error('Không thể sao chép: ', err);
            });
        }
    </script>
</body>
</html>
